var __sebAnalytics=function(){function e(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("msie")&&parseInt(e.split("msie")[1])}function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function n(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function a(e){if("[object Object]"===Object.prototype.toString.call(e)){var t,n={};for(t in e)n[t]=a(e[t]);return n}if("[object Array]"===Object.prototype.toString.call(e)){var o,n=[];for(o in e)n.push(a(e[o]));return n}return e}function o(){var e={userAgent:navigator.userAgent?navigator.userAgent:"",language:navigator.language?navigator.language:"",doNotTrack:navigator.doNotTrack?navigator.doNotTrack:"",cookieEnabled:navigator.cookieEnabled?navigator.cookieEnabled:"",platform:navigator.platform?navigator.platform:"",navigator:{appCodeName:navigator.appCodeName?navigator.appCodeName:"",appName:navigator.appName?navigator.appName:"",appVersion:navigator.appVersion?navigator.appVersion:"",buildID:navigator.buildID?navigator.buildID:""},sizes:{screen:{width:screen.width,height:screen.height,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth},window:{height:window.outerHeight,width:window.outerWidth},document:{height:window.innerHeight,width:window.innerWidth}}};return f.geoloc&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){b.context.position={latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,altitude:e.coords.altitude,timestamp:e.coords.timestamp}}),e}function i(){var t=this,n=[],o=[];this.push=function(e){(f.devMode||"127.0.0.1"!==location.hostname&&"localhost"!==location.hostname)&&(n.push(e),w.notifyTimer())},this.shift=function(){if(n.length){var t,i={events:[]},r=[];for(t in n){if(99<i.events.length)break;var u,d=!1,s=n[t];for(u in o)if(o[u].guid===s.guid){d=!0;break}d||(r.push(s),o.push(s),d=a(s),delete d.guid,i.events.push(d))}if(0<i.events.length){var l=function(){for(var e in r){for(var t=r[e],a=n.length-1;0<=a;a--)n[a].guid===t.guid&&n.splice(a,1);for(a=o.length-1;0<=a;a--)o[a].guid===t.guid&&o.splice(a,1)}},c=function(){for(var e in r)for(var t=r[e],a=o.length-1;0<=a;a--)n[a].guid===t.guid&&o.splice(a,1);for(e=n.length-1;0<=e;e--)n[e].ssid!==b.ssid&&n.splice(e,1);f.maxRetry--,0>=f.maxRetry?w.stop():w.wait(f.timeBetweenTries)},v=function(){var t=null;if(!window.XMLHttpRequest||e()&&10>e()){if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}}else t=new XMLHttpRequest;for(var n in i.events)i.events[n].cors=!1;if(t.open(m.configuration.ajaxMethod,m.configuration.url+b.ssid,f.async),f.async)try{t.onload=l,t.onabort=c,t.ontimeout=c,t.onerror=c}catch(e){t.onreadystatechange=function(){4==t.readyState&&(200<=t.status&&300>t.status?l():c())}}t.setRequestHeader("Content-type","text/plain");try{t.send(JSON.stringify(i)),f.async||(200<=t.status&&300>t.status?l():c())}catch(e){c()}},g=null;if(!window.XMLHttpRequest||e()&&10>e()){if(window.ActiveXObject)try{g=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){g=new ActiveXObject("Microsoft.XMLHTTP")}}else g=new XMLHttpRequest;if(g.open(m.configuration.ajaxMethod,m.configuration.url+b.ssid,f.async),f.async)try{g.onload=l,g.onabort=v,g.ontimeout=c,g.onerror=c}catch(e){g.onreadystatechange=function(){4==g.readyState&&(200<=g.status&&300>g.status?l():0==g.status?v():c())}}g.setRequestHeader("Content-type","application/json");try{g.send(JSON.stringify(i)),f.async||(200<=g.status&&300>g.status?l():0==g.status?v():c())}catch(e){v()}}}},this.flush=function(){if(n.length||o.length){var e=JSON.stringify(n);"undefined"!=typeof localStorage&&null!=localStorage?localStorage.setItem(h,e):s(h)}},this.removeAllEvents=function(){if(n.length||o.length){var e=n;return n=[],o=[],l(h),e}return[]},this.queuedEvent=function(){return n},this.sendStore=function(){var e;if("undefined"!=typeof localStorage&&null!=localStorage?(e=localStorage.getItem(h),localStorage.removeItem(h)):(e=c(h),l(h)),null!=e&&void 0!==e){e=JSON.parse(e);for(var n in e)t.push(e[n])}},d("submit","form[seb-analytics=true]",function(e){var t=e.target;e=t.getAttribute("element-type");var n,a=t.getAttribute("search-type"),t=t.querySelectorAll("input,textarea,select"),o={};for(n in t){var i=t[n];i.value?o[i.getAttribute("name")]=i.value:serialized[i.getAttribute("name")]||(o[i.getAttribute("name")]=i.value)}m.buildAndAddMappedEvent("SEARCH",[e,a,o])}),setInterval(function(){if(!y.length||location.hash!==y[y.length-1].hash){var e={hash:location.hash,date:(new Date).toISOString()};y.push(e)}},1e3),u(function(){m.buildAndAddMappedEvent("PAGEUNLOAD",[document.URL?document.URL:null,document.referrer?document.referrer:null,navigator.userAgent?navigator.userAgent:null,f.element_type,f.element_id,_,y]),t.flush()}),r(function(){t.sendStore(),m.buildAndAddMappedEvent("PAGELOAD",[document.URL?document.URL:null,document.referrer?document.referrer:null,navigator.userAgent?navigator.userAgent:null,f.element_type,f.element_id,_])}),this.getQueueLength=function(){return n.length}}function r(e){var t;document.addEventListener?(t=document.createEvent("Event"),t.initEvent("__sebanalytics_load_event",!0,!1),document.addEventListener("__sebanalytics_load_event",e)):document.attachEvent&&(document.documentElement.initAnalytics=0,document.documentElement.attachEvent("onpropertychange",function(t){"initAnalytics"==t.propertyName&&(e(),document.documentElement.detachEvent("onpropertychange",arguments.callee))})),"complete"===document.readyState?setTimeout(function(){document.dispatchEvent(t)},500):document.addEventListener?document.addEventListener("DOMContentLoaded",function(){document.dispatchEvent(t)}):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"interactive"!==document.readyState&&"complete"!==document.readyState||document.documentElement.initAnalytics++})}function u(e){window.addEventListener?window.addEventListener("unload",e):window.attachEvent("onunload",function(){e()})}function d(e,t,n){var a=function(e){var a;if(a=e.target)e:{a=e.target;var o,i=document.querySelectorAll(t);for(o in i)if(i[o]===a){a=!0;break e}a=!1}a&&n(e)};document.addEventListener?document.addEventListener(e,a):document.attachEvent("on"+e,a)}function s(e,t){if(document.cookie){for(var n=e+"=",a=document.cookie.split(";"),o=0;o<a.length;o++)if(0===a[o].trim().indexOf(n))return a[o]=e+"="+t,document.cookie=a.join(";"),!0;document.cookie+=e+"="+t+"; "}else document.cookie=e+"="+t+";";return!0}function l(e){if(document.cookie){e+="=";for(var t=document.cookie.split(";"),n=0;n<t.length;n++)if(0===t[n].trim().indexOf(e))return t.splice(n,1),document.cookie=t.join(";"),!0}return!1}function c(e){if(document.cookie){e+="=";for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var a=t[n].trim();if(0===a.indexOf(e))return a.substring(e.length,a.length)}}}var v,m={},g=!1,p={notInitialized:"__sebAnalytics is not initialized, did you call __sebAnalytics.init(datas)?\n",babInitParams:"Initialization failed, ssid or version invalid\n",badEventId:"Event id is unknown from seb analytics\n",badValuesEvent:"Value array doesn't match with its authorized values\n",badValue:"Value is not authorized: \n"};m.configuration={url:"https://dev.receiver.analytics.groupe-seb.com/events/",ajaxMethod:"POST",timerDefault:100};var f={async:!0,geoloc:!1,element_type:null,element_id:null,maxRetry:3,followDoNotTrackPolicy:!1,devMode:!1,timeBetweenTries:2e3},h="seb_analytics_events",_=n(),y=[],A={},b={type:"",date:"",ssid:"",version:"",libVersion:"v0.4.6",cors:!0,user:{userid:"",anonymousid:function(){var e="",e="undefined"!=typeof localStorage&&null!=localStorage?localStorage.getItem("seb_analytics_guid"):c("seb_analytics_guid");return e||(e=n(),"undefined"!=typeof localStorage&&null!=localStorage?localStorage.setItem("seb_analytics_guid",e):s("seb_analytics_guid",e)),e}()},params:[],context:{}},E={name:"",value:""},T={PAGELOAD:{authorized_param_names:"url referer user_agent element_type element_id uuid".split(" ")},PAGEUNLOAD:{authorized_param_names:"url referer user_agent element_type element_id uuid states_hashs".split(" ")},SEARCH:{authorized_param_names:["search_el_type","search_type","search_content"]},CONTENTLOAD:{authorized_param_names:"url parent_url element_type element_id content_type content uuid".split(" ")},CONTENTUNLOAD:{authorized_param_names:"url parent_url element_type element_id content_type content uuid".split(" ")},INVITATION:{authorized_param_names:["email"]},SHARE:{authorized_param_names:["recipe_id","shared_to","sharing_method"]},OPTIN_NEWS:{authorized_param_names:["optin_value"]},OPTIN_NEWSLETTER:{authorized_param_names:["optin_value"]}};Date.prototype.toISOString||function(){function e(e){return e=String(e),1===e.length&&(e="0"+e),e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}(),m.init=function(e){if(!e.ssid||!e.version)return console.error(p.babInitParams,"    at sebAna.init(datas)"),!1;b.ssid=e.ssid,b.version=e.version,!1===e.async&&(f.async=!1),e.geoloc&&(f.geoloc=!0),e.element_type&&(f.element_type=e.element_type),e.element_id&&(f.element_id=e.element_id),!0===e.devMode&&(f.devMode=!0),!0===e.followDoNotTrackPolicy&&(f.followDoNotTrackPolicy=!0),e.timeBetweenTries&&!isNaN(parseInt(e.timeBetweenTries))&&(f.timeBetweenTries=e.timeBetweenTries),g=!0,m.willTrack()&&(b.context=o(),w.start(),v=new i),f.devMode&&(console.info("You use sebAnalytics js lib version: "+m.version()+"\n"),m.willTrack()?(m.removeAllEvents=function(){return v.removeAllEvents()},m.queuedEvent=function(){return v.queuedEvent()},m.getOptionalParameters=function(){console.log(f)}):console.info("SEB analytics is configured to not track event."))},m.willTrack=function(){return!f.followDoNotTrackPolicy||1!=window.navigator.doNotTrack},m.addEvent=function(e){if(g){if(m.willTrack()){for(var t in e)if(t in["type"]?e[t]||console.error(p.invalidEvent,"    at sanitize event\n",'    [GRAVE] Event key "'+t+'" has a bad value\n'):"date"===t&&(e[t]?e.date.match(/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+)|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d)|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d)/)&&!isNaN(new Date(e.date))||console.error(p.invalidEvent,"    at sanitize event\n","    [GRAVE] Event date is an invalid date or is not in iso format\n"):e.date=(new Date).toISOString()),"params"===t)for(var a=e.params.length-1;0<=a;a--){var o=e.params[a];o&&o.name?void 0===o.value&&(o.value=null):e.params.splice(a,1)}e.guid=n(),v.push(e)}}else console.error(p.notInitialized,"    at sebAna.addEvent(event)\n")},m.buildAndAddMappedEvent=function(e,t,n){if(g){if(!(e in T))return console.error(p.badEventId,"    at sebAna.buildAndAddEvent(eventId, values)\n"),!1;var a=T[e];if("[object Array]"!==Object.prototype.toString.call(t)||t.length!==a.authorized_param_names.length)return console.error(p.badValuesEvent,"    at sebAna.buildAndAddEvent(eventId, values)\n","values length: "+t.length+", eventMap.authorized_param_names: "+a.authorized_param_names.length+"\n"),!1;var o,i=[];for(o in a.authorized_param_names)i.push(m.getParam(a.authorized_param_names[o],t[o]));return m.buildAndAddEvent(e,i,n),!0}console.error(p.notInitialized,"    at sebAna.buildAndAddMappedEvent(eventId, params, customDate \n")},m.buildAndAddEvent=function(e,t,n){if(g){var a=m.getPreBuildEvent();return a.type=e,n&&"[object Array]"===Object.prototype.toString.call(values)?a.date=n.toISOString():n&&(a.date=n),a.params=t,m.addEvent(a),!0}console.error(p.notInitialized,"    at sebAna.buildAndAddEvent(eventId, params, customDate \n")},m.getPreBuildEvent=function(){if(g)return a(b);console.error(p.notInitialized,"    at sebAna.getPreBuildEvent(event)\n")},m.getParam=function(e,t){if(g){var n=e?e:null,o=void 0!==t?t:null,i=a(E);return i.name=n,i.value=o,i}console.error(p.notInitialized,"    at sebAna.getPreBuildParam(event)\n")},m.setUserId=function(e){b.user.userid=e},m.genGUID=n,m.version=function(){return b.libVersion},m.addLoadContent=function(e,t){var o,i=a(e);if(o=T.CONTENTLOAD,i.length+1===o.authorized_param_names.length)o=n(),i.push(o);else{if(i.length!==o.authorized_param_names.length)return console.error(p.badValuesEvent,"    at sebAna.addLoadContent(values, customDate)","values length: "+i.length+", eventMap.authorized_param_names: "+o.authorized_param_names.length),!1;o=i[i.length-1]}return A[o]=i,m.buildAndAddMappedEvent("CONTENTLOAD",i,t),o},m.unloadByGUID=function(e,t){if(A[e]){var n=A[e];return delete A[e],m.buildAndAddMappedEvent("CONTENTUNLOAD",n,t),!0}return!1},m.unloadCustom=function(e,t){var n=a(e),o=T.CONTENTUNLOAD;return n.length!==o.authorized_param_names.length?(console.error(p.badValuesEvent,"    at sebAna.unloadCustom(values, customDate)","values length: "+n.length+", eventMap.authorized_param_names: "+o.authorized_param_names.length),!1):(A[n[n.length-1]]&&delete A[n[n.length-1]],m.buildAndAddMappedEvent("CONTENTUNLOAD",n,t),!0)},m.findLoadEventValues=function(e,t){var n,o=-1,i=T.CONTENTLOAD;for(n in i.authorized_param_names)i.authorized_param_names[n]===e&&(o=n);if(-1===o)return[];var r,i=[];for(r in A)n=A[r],n[o]===t&&i.push(a(n));return i},window.__sebAnalytics=m;var w=new function(){var e=this,t=!1,n=-1,a=m.configuration.timerDefault,o=function(){v.getQueueLength()?v.shift():(clearInterval(n),n=-1)};this.notifyTimer=function(){-1==n&&t&&(n=setInterval(o,a))},e.start=function(){t=!0,e.notifyTimer()},e.stop=function(){t=!1,clearInterval(n),n=-1},e.wait=function(t){e.stop(),setTimeout(function(){e.start()},t)}};return m}();